---
import { readFileSync } from 'fs';
import { resolve } from 'path';
import plantumlEncoder from 'plantuml-encoder';

interface Props {
  diagram?: string;
  file?: string;
  maxWidth?: string; // Add this prop
}

const { diagram, file } = Astro.props; // Default max width

let diagramSource = diagram;

// If file is provided, read it from the assets/diagrams folder
if (file) {
  const filePath = resolve('src/assets/diagrams', file);
  diagramSource = readFileSync(filePath, 'utf-8');
}

if (!diagramSource) {
  throw new Error('Either diagram or file prop must be provided to PlantUML component');
}

const encoded = plantumlEncoder.encode(diagramSource);
const imageUrl = `https://www.plantuml.com/plantuml/svg/${encoded}`;
---

<img
        src={imageUrl}
        alt="PlantUML diagram"
        class="h-auto my-4 mx-auto"
/>